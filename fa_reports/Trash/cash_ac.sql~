SELECT initcap(a.gl_mas_desc) AS gl_mas_desc, b.gl_mas_code, SUM(b.cnt) as cnt, SUM(b.received) as received, SUM(b.transfer) as transfer FROM gl_master as a, ( 

SELECT 'R' as typ, a.gl_mas_code, COUNT(*) as cnt, SUM(credit-debit) as received, 0.00 as transfer, 0.00 as Payment FROM mas_gl_tran as a WHERE a.gl_mas_code not like '28101' and tran_id in (SELECT tran_id FROM mas_gl_tran WHERE gl_mas_code like '28101' and debit-credit>0 and action_date>='2010-04-01' AND action_date<'2010-05-01') GROUP BY a.gl_mas_code 
UNION ALL 
SELECT 'P' as typ,a.gl_mas_code, COUNT(*) as cnt, 0.00 as received, 0.00 as transfer, SUM(debit-credit) as Payment FROM mas_gl_tran as a WHERE a.gl_mas_code not like '28101' and tran_id in (SELECT tran_id FROM mas_gl_tran WHERE gl_mas_code like '28101' and debit-credit<0 and action_date>='2010-04-01' AND action_date<'2010-05-01') GROUP BY a.gl_mas_code 
UNION ALL 
SELECT 'P' as typ, a.gl_mas_code, COUNT(*) as cnt, 0.00 as received, SUM(credit-debit) as transfer, 0.00 as Payment FROM mas_gl_tran as a WHERE a.gl_mas_code not like '28101' and debit-credit<0 and action_date>='2010-04-01' AND action_date<'2010-05-01' and tran_id not in (SELECT tran_id FROM mas_gl_tran WHERE gl_mas_code like '28101' and action_date>='2010-04-01' AND action_date<'2010-05-01') GROUP BY a.gl_mas_code 
UNION ALL 
SELECT 'R' as typ, a.gl_mas_code, COUNT(*) as cnt, 0.00 as received, SUM(credit-debit) as transfer, 0.00 as Payment FROM mas_gl_tran as a WHERE a.gl_mas_code not like '28101' and debit-credit<0 and action_date>='2010-04-01' AND action_date<'2010-05-01' AND tran_id not in (SELECT tran_id FROM mas_gl_tran WHERE gl_mas_code like '28101' and action_date>='2010-04-01' AND action_date<'2010-05-01') GROUP BY a.gl_mas_code  

) as b WHERE typ='R' and a.gl_mas_code=b.gl_mas_code GROUP BY b.gl_mas_code, a.gl_mas_desc ORDER BY CAST(b.gl_mas_code AS NUMERIC)

--------------------------------------------------------------------------------------------------
SELECT initcap(a.gl_mas_desc) AS gl_mas_desc, b.gl_mas_code, SUM(b.cnt) as cnt, SUM(b.payment) as payment, SUM(b.transfer) as transfer FROM gl_master as a, ( SELECT 'R' as typ, a.gl_mas_code, COUNT(*) as cnt, SUM(credit-debit) as received, 0.00 as transfer, 0.00 as Payment FROM mas_gl_tran as a WHERE a.gl_mas_code not like '28101' and tran_id in (SELECT tran_id FROM mas_gl_tran WHERE gl_mas_code like '28101' and debit-credit>0 and action_date>='2010-04-01' AND action_date<'2010-05-01') GROUP BY a.gl_mas_code UNION ALL SELECT 'P' as typ,a.gl_mas_code, COUNT(*) as cnt, 0.00 as received, 0.00 as transfer, SUM(debit-credit) as Payment FROM mas_gl_tran as a WHERE a.gl_mas_code not like '28101' and tran_id in (SELECT tran_id FROM mas_gl_tran WHERE gl_mas_code like '28101' and debit-credit<0 and action_date>='2010-04-01' AND action_date<'2010-05-01') GROUP BY a.gl_mas_code 
UNION ALL 
SELECT 'P' as typ, a.gl_mas_code, COUNT(*) as cnt, 0.00 as received, SUM(debit-credit) as transfer, 0.00 as Payment FROM mas_gl_tran as a WHERE a.gl_mas_code <> '28101' and action_date>='2010-04-01' AND action_date<'2010-05-01' and debit-credit>0 and tran_id not in (SELECT tran_id FROM mas_gl_tran WHERE action_date>='2010-04-01' AND action_date<'2010-05-01' AND gl_mas_code like '28101' OR tran_id IN (SELECT tran_id FROM mas_gl_tran WHERE action_date>='2010-04-01' AND action_date<'2010-05-01' GROUP BY tran_id HAVING COUNT(*)<2)) GROUP BY a.gl_mas_code UNION ALL 
SELECT 'R' as typ, a.gl_mas_code, COUNT(*) as cnt, 0.00 as received, SUM(debit-credit) as transfer, 0.00 as Payment FROM mas_gl_tran as a WHERE a.gl_mas_code <> '28101' and action_date>='2010-04-01' AND action_date<'2010-05-01' and debit-credit>0 and tran_id not in (SELECT tran_id FROM mas_gl_tran WHERE gl_mas_code like '28101') GROUP BY a.gl_mas_code ) as b WHERE typ='P' and a.gl_mas_code=b.gl_mas_code GROUP BY b.gl_mas_code, a.gl_mas_desc ORDER BY CAST(b.gl_mas_code AS NUMERIC)
-----------------------------------------------------------------------------------------------
select initcap(a.gl_mas_desc) AS gl_mas_desc, b.gl_mas_code, sum(b.cnt) as cnt, sum(b.received) as received, sum(b.transfer) as transfer from gl_master as a, ( 
select 'R' as typ, a.gl_mas_code, count(*) as cnt, sum(credit-debit) as received, 0.00 as transfer, 0.00 as Payment from mas_gl_tran as a where a.gl_mas_code not like '28101' and tran_id in (select tran_id from mas_gl_tran where gl_mas_code like '28101' and debit-credit>0 and action_date>='2010-04-01' AND action_date<'2010-05-01') group by a.gl_mas_code 
UNION ALL 
SELECT 'R' as typ, a.gl_mas_code, COUNT(*) as cnt, 0.00 as received, SUM(credit-debit) as transfer, 0.00 as Payment FROM mas_gl_tran as a WHERE a.gl_mas_code not like '28101' and debit-credit<0 and action_date>='2010-04-01' AND action_date<'2010-05-01' AND tran_id not in (SELECT tran_id FROM mas_gl_tran WHERE gl_mas_code like '28101' and action_date>='2010-04-01' AND action_date<'2010-05-01') GROUP BY a.gl_mas_code HAVING (a.gl_mas_code LIKE '28202' OR a.gl_mas_code LIKE '28201' OR a.gl_mas_code LIKE '28302' OR a.gl_mas_code LIKE '28301') 
) as b where a.gl_mas_code=b.gl_mas_code group by b.gl_mas_code, a.gl_mas_desc ORDER BY CAST(b.gl_mas_code AS NUMERIC)
-------------------------------------------------------------------------------------------------
